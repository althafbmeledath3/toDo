<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <h1 class="heading">To Do List</h1>
    <form action="/add-task" method="POST" id="form">
      <input
        type="text"
        name="task"
        placeholder="Enter the task"
        id="task_input"
      />
      <button type="submit" id="sbmt" value="add task">Add Task</button>
    </form>
    <div class="test" id="test"></div>

    <script>
      async function loadData() {
        let todo = document.getElementById("test");
        let response = await fetch("/getdata");
        let data = await response.json();
        let str = "";
        data.forEach((element) => {
          str += `  <div class="todos" id="todos">
            <h1>${element.task}</h1>
            <div class="btn">
                <button onClick='editTask("${element._id}","${element.task}")'>Edit</button>
                <button onClick='deleteTask("${element._id}")'>Delete</button>
                </div>
            </div>
        </div>`;
        });
        todo.innerHTML = str;
      }
      window.onload = function () {
        loadData();
      };

      async function editTask(id, up_task) {
        document.getElementById("task_input").value = up_task;
        document.getElementById("sbmt").innerHTML = "Update";
        document.getElementById("form").action = `/update/${id}`;
      }

      async function deleteTask(id) {
        let response = await fetch(`/delete/${id}`);
        if (response.ok) {
          console.log("Deleted Successfully");
          window.location.reload();
        } else {
          console.log("error");
        }
      }
    </script>
  </body>
</html>
